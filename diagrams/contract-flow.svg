<svg xmlns="http://www.w3.org/2000/svg" width="900" height="500" viewBox="0 0 900 500">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c5e8e" />
    </marker>
    <style>
      .box { fill: #e8f4f8; stroke: #2c5e8e; stroke-width: 2; rx: 6; ry: 6; }
      .actor { fill: #f0f8ff; stroke: #4a90c2; stroke-width: 2; rx: 8; ry: 8; }
      .text { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 14px; fill: #333; }
      .label { font-size: 12px; fill: #666; font-style: italic; }
      .arrow { stroke: #2c5e8e; stroke-width: 2; marker-end: url(#arrowhead); }
      .dashed { stroke: #666; stroke-width: 1.5; stroke-dasharray: 5,5; marker-end: url(#arrowhead); }
    </style>
  </defs>

  <rect width="100%" height="100%" fill="#fff"/>

  <!-- Actors -->
  <g transform="translate(50, 50)">
    <rect class="actor" x="0" y="0" width="120" height="50" />
    <text class="text" x="60" y="30" text-anchor="middle">Agent</text>
  </g>

  <g transform="translate(390, 50)">
    <rect class="actor" x="0" y="0" width="120" height="50" />
    <text class="text" x="60" y="30" text-anchor="middle">Smart Contract</text>
  </g>

  <g transform="translate(730, 50)">
    <rect class="actor" x="0" y="0" width="120" height="50" />
    <text class="text" x="60" y="30" text-anchor="middle">Buyer (Agent)</text>
  </g>

  <!-- Step 1: Register -->
  <g transform="translate(60, 150)">
    <rect class="box" x="0" y="0" width="180" height="60" />
    <text class="text" x="90" y="25" text-anchor="middle">registerAgent(wallet)</text>
    <text class="label" x="90" y="45">0.5 USDC deposit</text>
  </g>
  <text class="label" x="460" y="190" text-anchor="middle">Agent deposits to join</text>

  <!-- Arrow 1 -->
  <line class="arrow" x1="170" y1="180" x2="390" y2="180" />
  <text class="label" x="280" y="170" text-anchor="middle">deposit</text>

  <!-- Step 2: Post Offer -->
  <g transform="translate(60, 250)">
    <rect class="box" x="0" y="0" width="180" height="60" />
    <text class="text" x="90" y="25" text-anchor="middle">postOffer(kWh, price)</text>
    <text class="label" x="90" y="45">list on market</text>
  </g>
  <text class="label" x="460" y="290" text-anchor="middle">Offer created</text>

  <!-- Arrow 2 -->
  <line class="arrow" x1="170" y1="280" x2="390" y2="280" />
  <text class="label" x="280" y="270" text-anchor="middle">create</text>

  <!-- Step 3: Buyer Accepts -->
  <g transform="translate(740, 250)">
    <rect class="box" x="0" y="0" width="180" height="60" />
    <text class="text" x="90" y="25" text-anchor="middle">acceptOffer(offer_id)</text>
    <text class="label" x="90" y="45">transfer USDC</text>
  </g>
  <text class="label" x="570" y="290" text-anchor="middle">Buyer accepts</text>

  <!-- Arrow 3: Buyer to Contract -->
  <line class="dashed" x1="850" y1="280" x2="510" y2="280" />
  <text class="label" x="680" y="270" text-anchor="middle">accept</text>

  <!-- Arrow 3b: Contract to Agent (acceptance confirmation) -->
  <line class="arrow" x1="390" y1="320" x2="170" y2="320" />
  <text class="label" x="280" y="310" text-anchor="middle">confirmed</text>

  <!-- Step 4: Report Delivery -->
  <g transform="translate(60, 370)">
    <rect class="box" x="0" y="0" width="180" height="60" />
    <text class="text" x="90" y="25" text-anchor="middle">reportDelivery(offer_id)</text>
    <text class="label" x="90" y="45">signed kWh telemetry</text>
  </g>
  <text class="label" x="460" y="410" text-anchor="middle">Provide proof</text>

  <!-- Arrow 4 -->
  <line class="arrow" x1="170" y1="400" x2="390" y2="400" />
  <text class="label" x="280" y="390" text-anchor="middle">report</text>

  <!-- Step 5: Verify / Dispute -->
  <g transform="translate(400, 440)">
    <rect class="box" x="0" y="0" width="160" height="40" fill="#fff3e0" stroke="#ef6c00" />
    <text class="text" x="80" y="25" text-anchor="middle">Oracle verifies</text>
  </g>

  <!-- Arrow 5 -->
  <line class="arrow" x1="480" y1="460" x2="740" y2="460" />
  <text class="label" x="610" y="450" text-anchor="middle">validated</text>

  <!-- Step 6: Withdraw -->
  <g transform="translate(740, 370)">
    <rect class="box" x="0" y="0" width="180" height="60" />
    <text class="text" x="90" y="25" text-anchor="middle">withdrawRevenue()</text>
    <text class="label" x="90" y="45">move USDC to wallet</text>
  </g>
  <text class="label" x="850" y="410" text-anchor="middle">Revenue out</text>

  <!-- Arrow 6: contract to agent -->
  <line class="arrow" x1="510" y1="460" x2="510" y2="400" />
  <line class="arrow" x1="510" y1="400" x2="830" y2="400" />
  <text class="label" x="670" y="390" text-anchor="middle">available</text>

  <!-- Notes -->
  <text class="label" x="450" y="500" text-anchor="middle">Dispute possible if delivery data doesn't match buyer expectations</text>

</svg>