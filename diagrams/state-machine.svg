<svg xmlns="http://www.w3.org/2000/svg" width="900" height="500" viewBox="0 0 900 500">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#2c5e8e" />
    </marker>
    <style>
      .state { fill: #e3f2fd; stroke: #1565c0; stroke-width: 2; rx: 10; ry: 10; }
      .state-active { fill: #e8f5e9; stroke: #388e3c; }
      .state-emergency { fill: #ffebee; stroke: #c62828; }
      .text { font-family: 'Segoe UI', Tahoma, sans-serif; font-size: 14px; fill: #333; }
      .label { font-size: 12px; fill: #666; }
      .arrow { stroke: #2c5e8e; stroke-width: 2; marker-end: url(#arrowhead); }
    </style>
  </defs>

  <rect width="100%" height="100%" fill="#fff"/>

  <!-- Title -->
  <text class="text" x="450" y="40" text-anchor="middle" style="font-weight: bold; font-size: 18px;">Agent State Machine</text>

  <!-- States -->
  <!-- Idle -->
  <g transform="translate(370, 80)">
    <rect class="state" x="0" y="0" width="160" height="80" />
    <text class="text" x="80" y="40" text-anchor="middle">Idle</text>
    <text class="label" x="80" y="60" text-anchor="middle">Waiting for tasks</text>
  </g>

  <!-- Inferencing (Balanced) -->
  <g transform="translate(370, 240)">
    <rect class="state-active" x="0" y="0" width="160" height="80" />
    <text class="text" x="80" y="35" text-anchor="middle">Inferencing</text>
    <text class="label" x="80" y="55" text-anchor="middle">(Balanced mode)</text>
  </g>

  <!-- Selling Energy -->
  <g transform="translate(100, 240)">
    <rect class="state-active" x="0" y="0" width="160" height="80" />
    <text class="text" x="80" y="35" text-anchor="middle">Selling</text>
    <text class="text" x="80" y="55" text-anchor="middle">Energy</text>
  </g>

  <!-- Emergency Mode -->
  <g transform="translate(100, 80)">
    <rect class="state-emergency" x="0" y="0" width="160" height="80" />
    <text class="text" x="80" y="35" text-anchor="middle">Emergency</text>
    <text class="text" x="80" y="55" text-anchor="middle">Income Mode</text>
  </g>

  <!-- Transitions -->
  <!-- Idle -> Inferencing -->
  <line class="arrow" x1="450" y1="160" x2="450" y2="240" />
  <text class="label" x="460" y="200" text-anchor="middle">task available</text>

  <!-- Inferencing -> Selling -->
  <line class="arrow" x1="370" y1="280" x2="180" y2="280" />
  <text class="label" x="275" y="270" text-anchor="middle">battery_soc>0.8 &amp; solar>0.7</text>

  <!-- Selling -> Inferencing -->
  <line class="arrow" x1="180" y1="240" x2="370" y2="240" />
  <text class="label" x="275" y="250" text-anchor="middle">solar decreases</text>

  <!-- Inferencing -> Emergency -->
  <line class="arrow" x1="370" y1="320" x2="180" y2="380" />
  <text class="label" x="250" y="360" text-anchor="middle">battery_soc<0.2 &amp; USDC low</text>

  <!-- Emergency -> Inferencing -->
  <line class="arrow-green" x1="180" y1="380" x2="370" y2="320" />
  <text class="label" x="250" y="350" text-anchor="middle">battery charged</text>

  <!-- Idle -> Emergency -->
  <line class="arrow-red" x1="370" y1="160" x2="180" y2="140" />
  <text class="label" x="260" y="150" text-anchor="middle">critical</text>

  <!-- Emergency -> Selling -->
  <line class="arrow-green" x1="180" y1="160" x2="100" y2="240" />
  <text class="label" x="130" y="190" text-anchor="middle">solar available</text>

  <!-- Selling -> Emergency -->
  <line class="arrow-red" x1="100" y1="240" x2="100" y2="160" />
  <text class="label" x="110" y="200" text-anchor="middle">cloudy + urgent</text>

  <!-- Notes -->
  <g transform="translate(50, 400)">
    <rect class="state" x="0" y="0" width="800" height="80" fill="#fff9c4" stroke="#f9a825" />
    <text class="text" x="20" y="25">State transitions are driven by the Power Budget Scheduler based on battery SOC, solar forecast, and USDC balance.</text>
    <text class="text" x="20" y="50">Default: Balanced Inferencing. Emergency mode maximizes compute for revenue. Selling mode maximizes profit from excess energy.</text>
  </g>
</svg>